# 🔍 觸發關鍵詞分析報告

## 📊 功能觸發關鍵詞總覽

### 🌐 網頁詐騙分析觸發邏輯

#### 主要觸發條件（優先級從高到低）：

1. **URL檢測** - 最高優先級 ⭐⭐⭐⭐⭐
   ```
   包含任何HTTP/HTTPS連結或網域格式
   例如：https://example.com, www.google.com, bit.ly/abc123
   ```

2. **明確分析請求** - 高優先級 ⭐⭐⭐⭐
   ```
   "幫我分析" + 任何內容
   "幫忙看看" + 任何內容  
   "這是不是詐騙"
   "這是真的嗎"
   "這可靠嗎"
   "分析一下"
   "這樣是詐騙嗎"
   ```

3. **分析關鍵詞 + 疑問詞** - 中高優先級 ⭐⭐⭐
   ```
   包含："分析", "詐騙", "安全", "可疑", "風險", "網站" 
   同時包含："嗎"
   例如："這個網站安全嗎？", "這是詐騙訊息嗎？"
   ```

4. **多個詐騙關鍵詞** - 中優先級 ⭐⭐
   ```
   至少包含2個以下關鍵詞：
   "詐騙", "被騙", "騙子", "可疑", "轉帳", "匯款", "銀行帳號", 
   "個資", "身份證", "密碼", "通知", "中獎", "貸款", "投資", 
   "急需", "幫我處理", "急用", "解除設定", "提款卡", 
   "監管帳戶", "解凍", "安全帳戶", "簽證", "保證金", 
   "違法", "洗錢", "警察", "檢察官"
   ```

5. **跟踪模式觸發** - 低優先級 ⭐
   ```
   "被騙", "詐騙", "可疑", "不確定", "幫我看看", 
   "這是詐騙嗎", "這是真的嗎"
   ```

#### ❌ 不會觸發詐騙分析的情況：

- 簡短問候語（≤5字符）："你好", "嗨", "哈囉", "hey"
- 功能查詢："功能", "幫助", "會什麼", "能做什麼"
- 遊戲相關關鍵詞（見下方遊戲觸發詞）
- 詢問機器人原理："怎麼運作", "工作原理", "分析方式"
- 次數查詢："剩餘次數", "還有幾次", "剩下幾次"

---

### 🎮 土豆遊戲觸發關鍵詞

#### 觸發關鍵詞列表：
```
主要觸發詞：
"選哪顆土豆"      ⭐⭐⭐⭐⭐ (核心觸發詞)
"玩土豆"          ⭐⭐⭐⭐
"選土豆"          ⭐⭐⭐⭐
"土豆遊戲"        ⭐⭐⭐⭐
"玩遊戲"          ⭐⭐⭐
"選土豆遊戲"      ⭐⭐⭐
"開始遊戲"        ⭐⭐⭐

防詐騙遊戲相關：
"防詐騙遊戲"      ⭐⭐⭐⭐
"詐騙檢測"        ⭐⭐⭐
"測試防詐"        ⭐⭐⭐
"防詐測試"        ⭐⭐⭐
"詐騙遊戲"        ⭐⭐⭐
"反詐遊戲"        ⭐⭐⭐
"識別詐騙"        ⭐⭐⭐
```

---

## ⚠️ 關鍵詞衝突分析

### 🔍 發現的潛在衝突

#### 1. **"詐騙" 關鍵詞重複**
- **詐騙分析觸發**：包含"詐騙"會進入跟踪模式
- **遊戲觸發**：包含"詐騙檢測", "詐騙遊戲", "防詐騙遊戲"
- **衝突解決**：已在代碼中優先處理遊戲觸發（第721行處理遊戲早於第874行處理詐騙分析）

#### 2. **"遊戲" 關鍵詞潛在問題**
- **問題訊息**：「我想問你這個投資遊戲是詐騙嗎？」
- **可能結果**：可能觸發遊戲而非詐騙分析
- **建議**：需要更精確的匹配邏輯

---

## 🛡️ 優先級處理邏輯

### 當前系統的處理順序：
```
1. 移除機器人觸發詞 (@土豆)
2. 檢查空訊息 → 發送功能說明
3. 🎮 遊戲觸發檢查 (第721行)
4. 📋 詐騙類型列表查詢
5. 📝 特定詐騙類型查詢  
6. ⏰ 等待分析狀態處理
7. 🌐 詐騙分析檢查 (第874行)
8. 💬 一般閒聊回應
```

### ✅ 優勢：
- 遊戲功能被優先處理，避免被詐騙分析攔截
- URL 檢測有最高優先級，確保詐騙分析準確性
- 明確的排除條件防止誤觸發

### ⚠️ 需要注意的邊界案例：

1. **複合訊息**：
   ```
   問題："我在玩投資遊戲，這是詐騙嗎？"
   現狀：可能觸發遊戲功能
   建議：需要更精確的模式匹配
   ```

2. **詐騙 + 遊戲組合**：
   ```
   問題："有人傳遊戲連結給我，是詐騙嗎？"
   現狀：可能觸發遊戲功能  
   建議：檢查是否包含URL優先進行詐騙分析
   ```

---

## 🔧 改進建議

### 1. **精確匹配優化**
```python
# 建議修改遊戲觸發邏輯為精確匹配
def is_game_trigger(message: str) -> bool:
    message_lower = message.lower().strip()
    
    # 精確匹配完整詞語，而非包含關係
    exact_keywords = [
        "選哪顆土豆", "土豆遊戲", "玩土豆", "選土豆",
        "防詐騙遊戲", "詐騙檢測遊戲"
    ]
    
    # 檢查是否為精確匹配或明確的遊戲請求
    for keyword in exact_keywords:
        if keyword in message_lower:
            # 確保不是在詢問詐騙相關問題
            if not any(indicator in message_lower for indicator in 
                      ["這是詐騙嗎", "是不是詐騙", "安全嗎", "可靠嗎"]):
                return True
    
    return False
```

### 2. **URL優先檢查**
```python
# 在任何關鍵詞檢查前，先檢查URL
if contains_url(text_message):
    # 強制進入詐騙分析，不管其他關鍵詞
    return perform_fraud_analysis()
```

### 3. **明確分離閒聊系統**
```python
# 閒聊觸發條件（更明確）
def should_use_chat_response(text_message):
    # 不包含URL
    # 不匹配遊戲觸發詞
    # 不匹配詐騙分析觸發條件
    # 不是功能查詢
    return (not contains_url(text_message) and 
            not is_game_trigger(text_message) and
            not should_perform_fraud_analysis(text_message) and
            not is_function_inquiry(text_message))
```

---

## 📋 建議的觸發關鍵詞規範

### 🌐 網頁詐騙分析專用觸發詞
```
明確分析請求：
"請幫我分析這則訊息"
"幫我分析這個網站"  
"這是詐騙嗎"
"這安全嗎"
"這可靠嗎"

自動觸發：
包含任何URL連結
包含2個以上詐騙關鍵詞
```

### 🎮 土豆遊戲專用觸發詞
```
主要觸發詞：
"選哪顆土豆"
"玩土豆遊戲"
"土豆小遊戲"
"防詐騙測驗"
"開始遊戲"
```

### 💬 閒聊系統觸發
```
所有不符合上述條件的一般對話
例如：
"你好"
"今天天氣不錯"
"謝謝你"
"土豆是什麼"（詢問機器人相關）
```

---

## 🎯 總結與建議

### ✅ 目前運作良好的部分：
1. URL檢測優先級最高，詐騙分析準確
2. 遊戲觸發在詐騙分析之前，避免大部分衝突
3. 有明確的排除條件防止誤觸發

### ⚠️ 需要改進的部分：
1. 遊戲觸發詞過於寬泛，"遊戲"、"詐騙"等詞可能造成誤觸發
2. 複合訊息的處理邏輯需要更精確
3. 需要增加URL優先檢查邏輯

### 🔧 建議的改進順序：
1. **立即修復**：在遊戲觸發檢查前，先檢查是否包含URL
2. **短期改進**：優化遊戲觸發詞匹配邏輯，使用更精確的模式
3. **長期規劃**：建立更完整的意圖分類系統

---

**最後更新：** 2025-05-24  
**狀態：** 📊 分析完成，建議改進中 