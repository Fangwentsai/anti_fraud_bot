# 圖片URL自動分析功能

## 功能概述

當用戶在「文字或網站分析」中輸入圖片網址時，系統會自動檢測並使用圖片分析功能來分析圖片內容，檢測是否含有詐騙風險。

## 支援的圖片格式

### 圖片副檔名檢測
- `.jpg` / `.jpeg`
- `.png`
- `.gif`
- `.bmp`
- `.webp`
- `.svg`

### 支援的圖片網站
- `imgur.com` / `i.imgur.com`
- `postimg.cc`
- `imgbb.com` / `ibb.co`
- `tinypic.com`
- `photobucket.com`
- `flickr.com`
- `instagram.com`
- `facebook.com`

## 功能流程

1. **URL檢測**：系統檢測用戶輸入的訊息中是否包含URL
2. **圖片URL識別**：檢查URL是否符合圖片格式或來自圖片網站
3. **自動切換**：如果是圖片URL，自動使用圖片分析功能而非網站分析
4. **圖片下載**：系統自動下載圖片進行分析
5. **AI分析**：使用OpenAI GPT-4 Vision分析圖片內容
6. **風險評估**：檢測圖片中是否含有詐騙相關內容
7. **結果回覆**：以Flex Message格式回覆詳細分析結果

## 使用範例

### 輸入範例
```
土豆 請幫我分析這個網址：https://i.imgur.com/suspicious_ad.jpg
```

### 系統處理
1. 檢測到圖片URL（imgur.com + .jpg副檔名）
2. 自動切換到圖片分析模式
3. 下載並分析圖片內容
4. 檢測圖片中的文字、網址、可疑內容
5. 評估詐騙風險等級

### 回覆格式
- **風險等級**：極低風險 / 低風險 / 中風險 / 高風險 / 極高風險
- **詐騙類型**：投資詐騙、購物詐騙、釣魚網站等
- **詳細說明**：分析圖片內容發現的可疑點
- **防範建議**：具體的安全建議

## 技術實現

### 檢測邏輯
```python
# 檢查副檔名
image_extensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg']
if any(url.lower().endswith(ext) for ext in image_extensions):
    is_image_url = True

# 檢查圖片網站域名
image_domains = ['imgur.com', 'i.imgur.com', 'postimg.cc', ...]
if any(domain in parsed_url.netloc.lower() for domain in image_domains):
    is_image_url = True
```

### 分析流程
1. 使用 `image_handler.handle_image_url()` 處理圖片URL
2. 下載圖片並轉換為base64格式
3. 調用OpenAI GPT-4 Vision API進行分析
4. 解析分析結果並格式化回覆

## 錯誤處理

### 常見錯誤情況
- **圖片無法下載**：網址失效、網路問題
- **圖片格式不支援**：檔案損壞、格式錯誤
- **分析服務不可用**：OpenAI API問題、配額用盡

### 錯誤回覆
系統會提供友善的錯誤訊息和替代建議：
- 建議直接上傳圖片
- 確認圖片URL是否正確
- 稍後重試

## 安全特性

### 網域變形檢測
圖片分析會檢測圖片中的文字是否包含：
- 假冒知名網站的網址
- 可疑的釣魚網站連結
- 網域變形攻擊

### 內容分析
AI會分析圖片中的：
- 文字內容（OCR）
- 視覺元素
- 可疑的詐騙特徵
- 投資、購物、交友等詐騙類型

## 優勢

1. **無縫整合**：用戶無需切換模式，系統自動識別
2. **全面分析**：結合圖片內容和網址安全檢測
3. **智能識別**：支援多種圖片格式和網站
4. **詳細回覆**：提供具體的風險分析和防範建議
5. **錯誤處理**：完善的錯誤處理和用戶引導

## 使用場景

- 用戶收到可疑的圖片連結
- 社交媒體上的投資廣告截圖
- 購物網站的商品圖片
- 釣魚網站的頁面截圖
- 詐騙對話的截圖分享

這個功能大大提升了防詐騙機器人的實用性，讓用戶能夠更方便地分析各種形式的可疑內容。 