name: Keep Service Alive

on:
  schedule:
    # 每 14 分鐘執行一次（Render 免費方案 15 分鐘後休眠）
    - cron: '*/14 * * * *'
  workflow_dispatch: # 允許手動觸發

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping Service
      run: |
        echo "🔄 開始 ping 服務..."
        
        # 替換為你的 Render 服務 URL
        SERVICE_URL="https://your-render-service-url.onrender.com"
        
        # Ping keep-alive 端點
        response=$(curl -s -o /dev/null -w "%{http_code}" \
          --max-time 30 \
          --user-agent "GitHub-Actions-KeepAlive/1.0" \
          "${SERVICE_URL}/keep-alive")
        
        if [ "$response" = "200" ]; then
          echo "✅ 服務 ping 成功 - HTTP $response"
        else
          echo "⚠️ 服務 ping 失敗 - HTTP $response"
          exit 1
        fi
        
        # 也 ping 健康檢查端點
        health_response=$(curl -s -o /dev/null -w "%{http_code}" \
          --max-time 30 \
          --user-agent "GitHub-Actions-HealthCheck/1.0" \
          "${SERVICE_URL}/health")
        
        if [ "$health_response" = "200" ]; then
          echo "✅ 健康檢查成功 - HTTP $health_response"
        else
          echo "⚠️ 健康檢查失敗 - HTTP $health_response"
        fi
        
        echo "�� Keep-alive 任務完成" 