# 推薦行為檢測改進說明

## 問題描述

用戶回報了一個重要問題：當朋友推薦「土豆防詐機器人」的 LINE 聊天截圖被上傳分析時，系統錯誤地給出了「中風險」評級，將正當的防詐騙服務推薦誤判為可疑內容。

## 問題分析

### 原始問題
1. **缺乏上下文判斷**：系統沒有區分「推薦行為」和「詐騙內容」
2. **自己產品被誤判**：土豆防詐機器人是我們自己的產品，卻被標記為中風險
3. **過度敏感的分析**：對於簡單的好友推薦行為也給出了不必要的高風險評級

### 具體案例
用戶的截圖內容：
```
4:52
傑西蔡
今天
已讀
下午4:49
土豆防詐機器人
查看個人檔案
下午4:50
```

這明顯是：
- 正常的好友推薦行為
- 推薦的是我們自己的防詐騙產品
- 沒有任何詐騙相關的內容或要求

## 解決方案

### 1. 增加土豆防詐機器人檢測

新增 `_is_potato_antifraud_content()` 函數：

**檢測邏輯**：
- 識別土豆防詐相關關鍵詞：`"土豆防詐機器人", "土豆防詐", "土豆", "防詐機器人"`
- 確認是推薦/提醒行為：`"查看個人檔案", "個人檔案", "提醒", "建議", "推薦"`
- 排除詐騙關鍵詞：`"轉帳", "匯款", "投資", "獲利"` 等

**處理結果**：
- 風險等級：`極低風險`
- 詐騙類型：`正當防詐騙服務推薦`
- 說明：解釋這是正當的防詐騙服務，並提醒用戶注意被標記的帳號可能有問題

### 2. 增加簡單推薦行為檢測

新增 `_is_simple_recommendation()` 函數：

**檢測邏輯**：
- 文字長度較短（< 200字）
- 包含推薦關鍵詞：`"推薦", "介紹", "認識", "可以看看"`
- 包含聊天指標：`"上午", "下午", "今天", "已讀"`
- 不包含詐騙關鍵詞：`"轉帳", "投資", "獲利", "保證"` 等

**處理結果**：
- 風險等級：`極低風險`
- 詐騙類型：`正常好友推薦`
- 說明：解釋這是正常的推薦行為，但提醒保持警覺

### 3. 改進分析提示語

在 `image_analysis_service.py` 中增加特殊情況處理：

```
特殊情況處理：
1. 如果圖片顯示的是「土豆防詐機器人」相關內容，應評為「極低風險」或「無風險」
2. 如果圖片只是簡單的好友推薦行為，且沒有涉及金錢、投資等內容，應評為「極低風險」
3. 如果圖片內容是純粹的聊天截圖，沒有詐騙相關元素，應評為「極低風險」或「無風險」
4. 只有當圖片中明確包含詐騙關鍵詞、可疑連結、金錢要求等內容時，才應評為中風險以上
```

## 測試結果

經過測試驗證，新的檢測邏輯能夠正確識別：

✅ **土豆防詐機器人內容**：正確識別為極低風險
✅ **簡單好友推薦**：正確識別為極低風險  
✅ **詐騙內容**：正確排除，不會被誤判為推薦
✅ **正常聊天**：正確識別為極低風險

## 改進效果

### 對用戶的好處：
1. **避免誤報**：不會再將正當的推薦行為標記為中風險
2. **提升信任度**：自己的產品不會被誤判為可疑內容
3. **更精確的分析**：能夠區分真正的詐騙內容和正常推薦

### 對系統的好處：
1. **提高準確性**：減少假陽性（誤報）
2. **增強智能性**：能夠理解上下文和推薦行為
3. **保持敏感性**：對真正的詐騙內容仍然保持高度警覺

## 處理流程

現在當用戶上傳類似的截圖時，系統會：

1. **提取文字內容**
2. **檢查是否為土豆防詐機器人內容** → 如果是，直接返回極低風險
3. **檢查是否為簡單推薦行為** → 如果是，直接返回極低風險
4. **進行其他詐騙檢測** → 只有在前兩步都不符合時才進行

這樣確保了推薦行為能夠被正確識別，同時不影響對真正詐騙內容的檢測能力。 